<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lesson 1: The BeaconState Container ‚Äî Daily Ethereum Knowledge</title>
    <link rel="stylesheet" href="../assets/style.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚ü†</text></svg>">
</head>
<body>
    <header>
        <div class="container">
            <a href="../" style="text-decoration: none; color: inherit;">
                <h1>‚ü† Daily Ethereum Knowledge</h1>
            </a>
        </div>
    </header>
    
    <main class="container lesson-content">
        <article>
            <header class="lesson-header">
                <span class="lesson-number">Lesson 1</span>
                <h1>The BeaconState Container</h1>
                <div class="lesson-meta">
                    <time>2026-02-02</time>
                    <span>phase0/beacon-chain.md lines 567-588</span>
                </div>
            </header>
            
            <div class="lesson-body">
                <p><em>The central data structure of Ethereum consensus</em></p>

                <h2>üîç Overview</h2>
                <p>Everything in Ethereum's consensus layer revolves around one data structure: <code>BeaconState</code>. It's the complete snapshot of the beacon chain at any given slot ‚Äî containing every validator, every balance, every checkpoint, and all the historical data needed to validate new blocks.</p>

                <h2>üì¶ Phase 0 Definition</h2>
                <p>The original Phase 0 state structure (lines 567-588):</p>
                <pre><code>class BeaconState(Container):
    # Versioning
    genesis_time: uint64
    genesis_validators_root: Root
    slot: Slot
    fork: Fork
    
    # History
    latest_block_header: BeaconBlockHeader
    block_roots: Vector[Root, SLOTS_PER_HISTORICAL_ROOT]      # 8192 slots
    state_roots: Vector[Root, SLOTS_PER_HISTORICAL_ROOT]      # 8192 slots
    historical_roots: List[Root, HISTORICAL_ROOTS_LIMIT]
    
    # Eth1
    eth1_data: Eth1Data
    eth1_data_votes: List[Eth1Data, EPOCHS_PER_ETH1_VOTING_PERIOD * SLOTS_PER_EPOCH]
    eth1_deposit_index: uint64
    
    # Registry
    validators: List[Validator, VALIDATOR_REGISTRY_LIMIT]
    balances: List[Gwei, VALIDATOR_REGISTRY_LIMIT]
    
    # Randomness
    randao_mixes: Vector[Bytes32, EPOCHS_PER_HISTORICAL_VECTOR]
    
    # Slashings
    slashings: Vector[Gwei, EPOCHS_PER_SLASHINGS_VECTOR]
    
    # Attestations (Phase 0 only ‚Äî replaced in Altair)
    previous_epoch_attestations: List[PendingAttestation, MAX_ATTESTATIONS * SLOTS_PER_EPOCH]
    current_epoch_attestations: List[PendingAttestation, MAX_ATTESTATIONS * SLOTS_PER_EPOCH]
    
    # Finality
    justification_bits: Bitvector[JUSTIFICATION_BITS_LENGTH]  # 4 bits
    previous_justified_checkpoint: Checkpoint
    current_justified_checkpoint: Checkpoint
    finalized_checkpoint: Checkpoint</code></pre>

                <h2>üí° Key Insights</h2>
                
                <h3>Why separate <code>validators</code> and <code>balances</code>?</h3>
                <p>SSZ merkleization efficiency. Balances change every epoch (rewards/penalties), but validator records rarely change. Separating them means balance updates only touch the <code>balances</code> tree, not the entire validator list.</p>

                <h3>Rolling history windows</h3>
                <p><code>block_roots</code> and <code>state_roots</code> are fixed-size vectors (8192 slots ‚âà 27 hours). Old history gets batched into <code>historical_roots</code>. This bounds state size while maintaining necessary lookback for attestation validation.</p>

                <h3>The state root commitment</h3>
                <p>Every <code>BeaconBlock</code> includes <code>state_root</code> ‚Äî the <code>hash_tree_root(state)</code> after applying that block. This 32-byte value commits to the entire state, enabling light client proofs.</p>

                <h2>üîó Fork Evolution</h2>
                <table>
                    <tr><th>Fork</th><th>State Changes</th></tr>
                    <tr><td>Altair</td><td><code>previous/current_epoch_attestations</code> ‚Üí <code>previous/current_epoch_participation</code> (flags); add <code>inactivity_scores</code>, <code>current_sync_committee</code>, <code>next_sync_committee</code></td></tr>
                    <tr><td>Bellatrix</td><td>Add <code>latest_execution_payload_header</code></td></tr>
                    <tr><td>Capella</td><td>Add <code>next_withdrawal_index</code>, <code>next_withdrawal_validator_index</code>, <code>historical_summaries</code> (replaces <code>historical_roots</code>)</td></tr>
                    <tr><td>Deneb</td><td>No state changes</td></tr>
                    <tr><td>Electra</td><td>Add <code>deposit_requests_start_index</code>, <code>pending_deposits</code>, <code>pending_partial_withdrawals</code>, <code>pending_consolidations</code>, and balance consumption tracking fields</td></tr>
                </table>

                <h2>üìä Key Constants</h2>
                <pre><code>SLOTS_PER_HISTORICAL_ROOT = 8192        # ~27 hours of block/state roots
EPOCHS_PER_HISTORICAL_VECTOR = 65536    # ~290 days of RANDAO mixes
EPOCHS_PER_SLASHINGS_VECTOR = 8192      # ~36 days for correlation penalty
VALIDATOR_REGISTRY_LIMIT = 2**40        # ~1.1 trillion theoretical max</code></pre>

                <h2>üìñ Spec Reference</h2>
                <ul>
                    <li><code>phase0/beacon-chain.md</code> lines 567-588 ‚Äî Phase 0 BeaconState</li>
                    <li><code>altair/beacon-chain.md</code> lines 159-190 ‚Äî Altair modifications</li>
                    <li><code>bellatrix/beacon-chain.md</code> lines 117-146 ‚Äî Execution payload header</li>
                </ul>
            </div>
        </article>
        
        <nav class="lesson-nav">
            <a href="../">‚Üê All Lessons</a>
            <a href="002-slots-epochs-time.html">Lesson 2 ‚Üí</a>
        </nav>
    </main>
    
    <footer>
        <div class="container">
            <p>Source: <a href="https://github.com/nerolation/daily-eth-knowledge">github.com/nerolation/daily-eth-knowledge</a></p>
        </div>
    </footer>
</body>
</html>
